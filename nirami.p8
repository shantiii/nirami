pico-8 cartridge // http://www.pico-8.com
version 42
__lua__

#include dialog.lua

-- utils

function to_screen(x) return x*8+24 end

-- the camera offset

function cam_init()
 cam_x = 0
 cam_y = 0
end

-- the player

function pla_init()
 pla_x = 2
 pla_y = 4
end

function cam_update()
 if btnp(0) and cam_x > 0 then cam_x -= 1 end --left
 if btnp(1) and cam_x < 2 then cam_x += 1 end --right
 if btnp(2) and cam_y > 0 then cam_y -= 1 end --up
 if btnp(3) and cam_y < 3 then cam_y += 1 end --down
end

function pla_draw()
 spr(7, to_screen(pla_x), to_screen(pla_y))
end

-- the map

function map_init()
 map = {
  {17,17,17,18,1,1,2,1,1,1,1},
  {17,17,17,18,1,1,2,1,1,1,1},
  {17,17,17,18,1,1,2,1,1,1,1},
  {17,17,17,18,1,1,2,1,1,1,1},
  {17,17,17,18,1,1,2,1,1,1,1},
  {17,17,17,18,1,1,2,1,1,1,1},
  {17,20,17,18,1,1,2,1,1,1,1},
  {17,36,17,18,1,1,2,1,1,1,1},
  {17,17,17,18,1,1,2,1,1,1,1},
  {17,17,17,18,1,1,2,1,1,1,1},
  {17,17,17,18,1,1,2,1,1,1,1}
 }
end

function map_draw()
 --8x8 window in the middle of the screen
 for i=1,8 do
  for j=1,8 do
   spr(map[j+cam_y][i+cam_x], to_screen(i), to_screen(j))
  end
 end
end

function _init()
 pla_init()
 cam_init()
 map_init()
 local forest = {
  [1] = {"it's a lovely day\nin northern tokyo", "and you are a\nhorrible gaijin", 2},
  [2] = nil,
  [3] = "where from?",
 }
 dialog_state = dia_init(forest)
end 

function _update()
 cam_update()
 if btnp(0)
 then
 dia_update(dialog_state, true)
 else
 end
end

function _draw()
 cls()
 map_draw()
 pla_draw()
 dia_render(dialog_state)
end

-->8
---where is this?
__gfx__
0000000055555555555dd55577777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000055555555555dd55577777777000000000000000000ffff00000000000000000000000000000000000000000000000000000000000000000000000000
0070070055555555555dd555777777770000000000000000005ff500004444000000000000000000000000000000000000000000000000000000000000000000
00077000555555555555555577788777000000000000000000ffff00004f4f0000000cc000000000000000000000000000000000000000000000000000000000
000770005555555555555555777887770000000000000000000224400044440000cccc0000000000000000000000000000000000000000000000000000000000
0070070055555555555dd55577777777000000000003300000022040000110000dc00cd000000000000000000000000000000000000000000000000000000000
0000000055555555555dd55577777777000000000033330000055040000110000dd00dd000000000000000000000000000000000000000000000000000000000
0000000055555555555dd55577777777000000000333333000011040000dd0000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666575588888888888888860333333000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666575588888888877777860033330000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666575577777777887778860004400000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666575577770777688788660004400000ffff0000444400099cc9cc00000000000000000000000000000000000000000000000000000000
000000006666666666665755777707776688866600044000005ff500004f4f00090cc0cc00000000000000000000000000000000000000000000000000000000
00000000666666666666575577070077666866660004400000ffff00004444000000000000000000000000000000000000000000000000000000000000000000
000000006666666666665755770707776665666600044000000ee000000110000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666575570000007666566660004400000011000000dd0000000000000000000000000000000000000000000000000000000000000000000
00000000575555555555557500000000666566660000000000000000000000000007000000000000000000000000000000000000000000000000000000000000
00000000575555555555557500000000666566660000000000000000000000000077700000000000000000000000000000000000000000000000000000000000
00000000575555555555557500000000666566660000000009400004004444000077700000000000000000000000000000000000000000000000000000000000
00000000575555555555557500000000666566660000000044444444004f4f000aaaaa0000000000000000000000000000000000000000000000000000000000
00000000575555555555557500000000666566660000000000444440004444c00999990000000000000000000000000000000000000000000000000000000000
0000000057555555555555750000000066656666000000000004004000011c000099900000000000000000000000000000000000000000000000000000000000
000000005755555555555575000000006665666600000000004404400dccccd00099900000000000000000000000000000000000000000000000000000000000
000000005755555555555575000000006666666600000000000000000dd00dd00009000000000000000000000000000000000000000000000000000000000000
